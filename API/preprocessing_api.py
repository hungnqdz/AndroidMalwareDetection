import pandas as pd
import re


class PreprocessingApi(object):
    def __init__(self, data):
        self.df = pd.DataFrame(data)

    def show_df(self):
        return self.df

    def pre_data(self, result):
        string_without_dollar = result.replace("$", " ")
        string_without_digits = ''.join(char for char in string_without_dollar if not char.isdigit())
        final = re.sub(r'\s+', ' ', string_without_digits)
        return final

    def preprocessing_package(self, api):
        package = api.split(';')[0]
        package_line = package.split('/')
        result = ''
        for p in package_line:
            result += p + ' '
        return self.pre_data(result.strip())

    def execute(self):
        result = set()
        for index, row in self.df.iterrows():
            value = row[self.df.columns[0]]
            result.add(self.preprocessing_package(value))
        self.set_package = result
        return result

    def write_to_file(self, path):
        with open(path, 'w') as f:
            for item in self.set_package:
                print("writing %s to %s..." % (item, path))
                f.write("%s\n" % item)
